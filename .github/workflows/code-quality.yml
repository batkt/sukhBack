name: Code Quality

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main, dev ]

jobs:
  quality-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'

    - name: Install dependencies
      run: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          echo "‚ö†Ô∏è package-lock.json not found, using npm install"
          npm install
        fi

    - name: Check for common issues
      run: |
        echo "üîç Checking code quality..."
        
        # Check for TODO/FIXME comments
        echo "üìù Checking for TODO/FIXME comments..."
        if grep -r "TODO\|FIXME" --include="*.js" --exclude-dir=node_modules .; then
          echo "‚ö†Ô∏è Found TODO/FIXME comments"
        fi
        
        # Check for console statements (excluding entry logs)
        echo "üìù Checking for console statements..."
        if grep -r "console\.\(log\|error\|warn\|info\|debug\)" --include="*.js" --exclude-dir=node_modules . | grep -v "–ò–π—à—ç—ç –æ—Ä–ª–æ–æ"; then
          echo "‚ö†Ô∏è Found console statements (excluding entry logs)"
        fi
        
        # Check for hardcoded secrets
        echo "üîí Checking for potential hardcoded secrets..."
        if grep -r -i "password\|secret\|api_key\|token" --include="*.js" --exclude-dir=node_modules . | grep -v "process.env\|req.body\|req.query"; then
          echo "‚ö†Ô∏è Found potential hardcoded secrets - please review"
        fi
        
        echo "‚úÖ Code quality check completed"

